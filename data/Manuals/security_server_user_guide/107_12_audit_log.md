## 12 Audit Log

The Security Server keeps an audit log. The audit log events are generated by the user interface and the management REST API when the user changes the system's state or configuration. The user actions are logged regardless of whether the outcome was a success or a failure. The complete list of the audit log events is described in \[[SPEC-AL](#Ref_SPEC-AL)\].

Actions that change the system state or configuration but are not carried out using the user interface or the management REST API are not logged (for example, X-Road software installation and upgrade, user creation and permission granting, and changing the configuration files).

An audit log record contains correlation-id, which can be used to link the record to other log messages about the same request.

An audit log record also contains:

-   the description of the user action,

-   the date and time of the event,

-   the username of the user performing the action

-   the authentication type used for this request (Session, ApiKey or HttpBasicPam)
    - `Session` – session based authentication (web application)
    - `ApiKey` - direct API call using API key authentication
    - `HttpBasicPam` – HTTP basic authentication with PAM login (for api key management API operations)

-   the API url for this request, and

-   the data related to the event.

For example, registering a new client in the Security Server produces the following log record:

  `2020-06-03T11:00:51+00:00 my-security-server-host correlation-id: [24b47d04dc6e1c49] INFO  [X-Road Proxy Admin REST API] 2020-06-03T11:00:51.944Z - {"event":"Register client","user":"admin1","auth":"Session","url":"/api/v1/clients/LXD:GOV:M1:audit-test/register","data":{"clientIdentifier":{"xRoadInstance":"LXD","memberClass":"GOV","memberCode":"M1","subsystemCode":"audit-test","clientStatus":"registration in progress"}}}`

The event is present in JSON \[[JSON](#Ref_JSON)\] format, in order to ensure machine processability.
The field event represents the description of the event, the field user represents the user name of the performer, and the field data represents data related with the event.
Field auth represents the authentication type, and url represents the API url.
The failed action event record contains additional fields reason for the error message, and boolean warning to document whether failure was due to an unhandled warning.
For example:

  `2020-06-03T10:57:46+00:00 my-security-server-host correlation-id: [49458d51a0bbe9ed] INFO  [X-Road Proxy Admin REST API] 2020-06-03T10:57:46.417Z - {"event":"Log in to token failed","user":"admin1","reason":"org.niis.xroad.restapi.service.TokenService$PinIncorrectException: Signer.PinIncorrect: PIN incorrect","warning":false,"auth":"Session","url":"/api/v1/tokens/0/login","data":{"tokenId":"0","tokenSerialNumber":null,"tokenFriendlyName":"softToken-0"}}`

By default, audit log is located in the file

    /var/log/xroad/audit.log